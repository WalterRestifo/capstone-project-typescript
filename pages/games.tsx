import Head from "next/head";
import Header from "../components/Header";
import Navigation from "../components/Navigation";
import styled from "styled-components";
import Link from "next/link";
import MiniCard from "../components/MiniCard";
import { MiniPlayer, Team } from "../interfaces/interfaces";
import { useEffect, useState } from "react";

export default function Games(): JSX.Element {
  const [matches, setMatches] = useState([]);

  useEffect(() => {
    const team1WithPoints = localStorage.getItem("team1WithPoints");
    const team2WithPoints = localStorage.getItem("team2WithPoints");
    if (team1WithPoints && team2WithPoints) {
      const team1Obj = JSON.parse(team1WithPoints);
      const team2Obj = JSON.parse(team2WithPoints);
      setMatches([...matches, [team1Obj, team2Obj]]);
    }
    console.log("matches: ", matches);
  }, []);

  function handleDelete() {
    setMatches([]);
  }

  function handleEmptyLocalStorage() {
    localStorage.removeItem("team1");
    localStorage.removeItem("team2");
    localStorage.removeItem("team1WithPoints");
    localStorage.removeItem("team2WithPoints");
  }

  return (
    <StyledDiv>
      <Head>
        <title>MatchBall</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <Header teaser={"Games"} />
      <section>
        {matches &&
          matches.map((match: []) =>
            match.map((team: Team) => {
              return (
                <StyledTeam key={team.players[0].name + team.points}>
                  {team.players.map((player: MiniPlayer) => (
                    <MiniCard
                      key={player.name + player.cloudinarySrc}
                      name={player.name}
                      cloudinarySrc={player.cloudinarySrc}
                    />
                  ))}
                  <p>{team.points}</p>
                </StyledTeam>
              );
            })
          )}
      </section>
      <section>
        <button onClick={handleEmptyLocalStorage}>
          <Link href={"/teamChoiceForm"}>Add a new game</Link>
        </button>
        <button onClick={handleDelete}>Delete all games</button>
      </section>
      <Navigation />
    </StyledDiv>
  );
}

const StyledDiv = styled.div`
  height: 100vh;
  display: grid;
  grid-template-rows: 7rem auto 4rem;
  padding: 0;
`;

const StyledTeam = styled.div`
  border: 1px solid white;
  display: flex;
`;
